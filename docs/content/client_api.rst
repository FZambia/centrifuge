Client API
==========

.. _client_api:

There are two ways to communicate with Centrifuge from browser. First, you can use
pure Websockets. Second, SockJS library - ['websocket', 'xdr-streaming', 'xhr-streaming',
'iframe-eventsource', 'iframe-htmlfile', 'xdr-polling', 'xhr-polling', 'iframe-xhr-polling',
'jsonp-polling'] can be used.

Javascript client designed to be very simple. I think the most difficult part of it is
configuration. But lets go through its API step by step.

When you have Centrifuge instance running - it is time to communicate with it from browser.

First, import javascript client into your web page:

.. code-block:: html

    <script src="https://github.com/FZambia/centrifuge/blob/js/src/centrifuge/web/frontend/static/application/js/event_emitter.js"></script>
    <script src="https://github.com/FZambia/centrifuge/blob/js/src/centrifuge/web/frontend/static/application/js/centrifuge.js"></script>


Then create new centrifuge object:

var centrifuge = new Centrifuge();

You've just created empty object which does not know anything about your Centrifuge
installation. To tell it that information you must use method ``configure``

.. code-block:: javascript

    centrifuge.configure({
        url: "",
        project:"",
        user: "",
        token: ""
    })

url is a Centrifuge endpoint - SockJS or Websocket. Note that in case of using SockJS
it must be imported on your page before Centrifuge's javascript client.

project is project ID from Centrifuge. Every project in Centrifuge has unique ID.
You can see it on project settings page of administrative web interface. This is
just a string.

user is your web application's current user unique ID. It must be string and can
be empty string if you want to allow anonymous access to your real-time application.

token is a secret key generated by your web application based on project secret key,
project ID and user ID. Every project in Centrifuge has secret key. You must never
show it to anyone else. The only two who know secret key are Centrifuge itself and
your web application backend. To create token you must use HMAC algorithm. For example
for python:

.. code-block:: python

    import hmac
    token = hmac.new(SECRET_KEY)
    token.update(PROIECT_ID)


Correct token guarantees that connection request to Centrifuge contains valid
information about project and user IDs. Token is similar to HTTP cookie, client must
not show it to anyone else. Remember that you must  always use channels in private
categories when working with data of limited access.

Now centrifuge client configured and you are ready to start communicating.

It is as simple as:

.. code-block:: javascript

    centrifuge.connect();

This line makes actual connection request to Centrifuge with data you provided
in configure method. Of course you do not want to just connect. You want to listen
or to send messages from(into) channels. The first step is to subscribe on channel
of your interest. But you can only start subscribing when connection with Centrifuge
was successfully established. If you try to subscribe on channel before connection
established - your subscription request will be rejected by Centrifuge. There is
an event about successful connection and you can bind your subscription logic to it
in this way:

.. code-block:: javascript

    centrifuge.on('connect', function() {
        // now you can subscribe
    });

It is very simple to subscribe on channel of certain category. Just write:

.. code-block:: javascript

    var subscription = centrifuge.subscribe('/category/channel', function(message) {
        // called when message received from this channel
    });


If category of channel has publish option on you can publish messages into this
channel. But you can not do it immediately after subscription request. You can
only publish when ``subscribe:success`` event will occure. The same in case of presence
and history requests. Lets publish message, get presence and get history data as
soon as our subscription request returned successful subscription response:

.. code-block:: javascript

    subscription.on('subscribe:success', function() {
        subscription.publish("hello");
        subscription.presence(function(data) {console.log(data)});
        subscription.history (function(data) {console.log(data)});
    });

And finally you can unsubscribe from subscription:

.. code-block:: javascript

    subscription.unsubscribe();

In some cases you need to disconnect your client from Centrifuge:

.. code-block:: javascript

    centrifuge.disconnect();

After calling this client will not try to reestablish connection periodically.