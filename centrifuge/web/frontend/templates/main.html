{% extends 'base.html' %}

{% block extra_scripts %}
<script type="text/javascript" src="{{ static_url('libs/sockjs/sockjs-0.3.4.min.js') }}"></script>
<script type="text/javascript" src="{{ static_url('application/js/prettify.js') }}"></script>
<script type="text/javascript" src="{{ static_url('application/js/main.js') }}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $.centrifuge_main();
    });
</script>
{% end %}

{% block content %}
<script type="text/x-jsrender" id="event_template">
    <div class="event" id="event-{{!>event_id}}" style="display: none;">
        <div class="event-header">
            <span class="event-key">
                <span class="event-key-word text-muted">
                    {{!>channel}}
                </span>
                <span class="event-time text-muted">{{!>time}}</span>
            </span>
        </div>
        <div class="event-description">
            <pre>{{!:data}}</pre>
        </div>
    </div>
</script>

<script type="text/x-jsrender" id="tab_pane_template">
    <div class="tab-pane in active" id="{{!>name}}">
        <div class="log"></div>
    </div>
</script>

<script type="text/x-jsrender" id="tab_template">
    <li>
        <a class="project-tab" href="#{{!>name}}" id="tab-{{!>name}}" data-name="{{!>name}}" data-tab-open="{{!>name}}" data-toggle="tab">
            {{!>tab_text}}
            <span class="label label-success pull-right project-event-counter hidden">0</span>
        </a>
    </li>
</script>

<script type="text/x-jsrender" id="node_info_row_template">
    <tr id="node-info-row-{{!>uid}}">
        <td class="node-info-name">{{!>name}}</td>
        <td class="node-info-channels">{{!>metrics['channels']}}</td>
        <td class="node-info-clients">{{!>metrics['clients']}}</td>
        <td class="node-info-unique-clients">{{!>metrics['unique_clients']}}</td>
        <td class="node-info-messages-per-second">{{!>metrics['messages.rate'] || 0}}</td>
        <td class="node-info-broadcast-avg">{{!>metrics['broadcast.avg'] || 0}}</td>
        <td class="node-info-api-count">{{!>metrics['api.count'] || 0}}</td>
    </tr>
</script>

<script type="text/x-jsrender" id="info_template">
    <div class="stat-row">
        <span class="text-muted stat-key">Version:</span>
        &nbsp;
        <span class="stat-value">{{!>centrifuge_version}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">SockJS endpoint:</span>
        &nbsp;
        <span class="stat-value" id="sockjs-endpoint">{{!>sockjs_endpoint}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">WebSocket endpoint:</span>
        &nbsp;
        <span class="stat-value" id="websocket-endpoint">{{!>ws_endpoint}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">HTTP API endpoint:</span>
        &nbsp;
        <span class="stat-value" id="api-endpoint">{{!>api_endpoint}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">Engine:</span>
        &nbsp;
        <span class="stat-value">{{!>engine}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">Current node:</span>
        &nbsp;
        <span class="stat-value" id="current-node">{{!>node_name}}</span>
    </div>
    <div class="stat-row">
        <span class="text-muted stat-key">Nodes running:</span>
        &nbsp;
        <span class="stat-value" id="node-count">{{!>node_count}}</span>
    </div>
    <div class="node_info">
        <table class="table table-bordered">
            <thead class="cf">
            <tr>
                <th title="node name">Node name</th>
                <th title="active channels">Channels</th>
                <th title="connected clients">Clients</th>
                <th title="unique clients">Unique</th>
                <th title="messages per second">Msg/sec</th>
                <th title="broadcast average time in milliseconds">Broadcast</th>
                <th title="api calls">API calls</th>
            </tr>
            </thead>
            <tbody id="node-info">
                <tr id="node-info-loader">
                    <td colspan="7">Waiting for information...</td>
                <tr>
            </tbody>
        </table>
    </div>
</script>

<div id="main-content">
    <div class="row">
        <div class="col-lg-3">
            <ul class="nav nav-pills nav-stacked" id="tabs">
                <li class="general-info-item">
                    <a class="info-tab" href="#_info" id="tab-_info" data-tab-open="_info" data-name="_info" data-toggle="tab">
                        General information
                    </a>
                </li>
            </ul>
        </div>
        <div class="col-lg-9">
            <a href="#" class="btn btn-success" id="project-settings">project management</a>
            <span class="pull-right connected label label-success" style="display: none;" title='connected to Centrifuge'>
                connected
            </span>
            <span class="pull-right not-connected label label-danger" style="display: none;" title='disconnected from Centrifuge'>
                disconnected
            </span>
            <div class="tab-content" id="tab-content">
                <div class="tab-pane" id="_info">

                </div>
            </div>
        </div>
    </div>
</div>
{% end %}



